<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - DealerOS</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDKs - MUST BE IN THIS ORDER -->
<!-- NEW (CORRECT) - Compatible version -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar container">
            <a href="index.html" class="logo">DealerOS</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link active">Dashboard</a>
                <a href="inventory.html" class="nav-link">Inventory</a>
                <a href="#" id="addCarBtn" class="nav-link">Add Car</a>
                <a href="#" id="profileBtn" class="nav-link">Profile</a>
                <button id="logoutBtn" class="btn btn-danger">Logout</button>
            </div>
        </nav>
    </header>
    
    <!-- Main Content -->
    <main class="container">
        <div style="margin: 2rem 0;">
            <h1>Dashboard</h1>
            <p style="color: var(--gray);">Welcome back to your dealership management system</p>
        </div>
        
        <!-- Dashboard Cards -->
        <div class="dashboard-cards" id="dashboardCards">
            <!-- Cards will be populated by JavaScript -->
            <div class="card">
                <h3 class="card-title">Total Cars</h3>
                <div class="card-value" id="totalCars">0</div>
                <div class="card-subtitle" id="totalCarsTrend">Loading...</div>
            </div>
            
            <div class="card">
                <h3 class="card-title">Cars in Transit</h3>
                <div class="card-value" id="carsInTransit">0</div>
                <div class="card-subtitle">Imported vehicles</div>
            </div>
            
            <div class="card">
                <h3 class="card-title">Cars in Yard</h3>
                <div class="card-value" id="carsInYard">0</div>
                <div class="card-subtitle">Available for sale</div>
            </div>
            
            <div class="card">
                <h3 class="card-title">Total Value</h3>
                <div class="card-value" id="totalValue">KES 0</div>
                <div class="card-subtitle">Inventory value</div>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="table-container">
            <h3 style="padding: 1.5rem; margin: 0;">Recent Cars</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Vehicle</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Price</th>
                        <th>Added</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recentCars">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </main>
    
    <!-- Add Car Modal -->
    <div class="modal" id="addCarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Vehicle</h3>
                <button onclick="closeModal('addCarModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCarForm">
                    <div class="form-group">
                        <label for="carType">Car Type *</label>
                        <select id="carType" class="form-control" required>
                            <option value="">Select type</option>
                            <option value="imported">Imported (In Transit)</option>
                            <option value="yard">Showroom / Yard Car</option>
                        </select>
                    </div>
                    
                    <div id="importedFields" style="display: none;">
                        <!-- Imported car fields will be shown here -->
                    </div>
                    
                    <div id="yardFields" style="display: none;">
                        <!-- Yard car fields will be shown here -->
                    </div>
                    
                    <div class="form-group">
                        <label for="vehicleName">Vehicle Name *</label>
                        <input type="text" id="vehicleName" class="form-control" placeholder="e.g., Toyota Harrier 2018" required>
                    </div>
                    
                    <div id="commonFields">
                        <!-- Common fields for both types -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('addCarModal')" class="btn">Cancel</button>
                <button onclick="saveCar()" class="btn btn-success">Save Vehicle</button>
            </div>
        </div>
    </div>
    
    <!-- QR Modal -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Car QR Code</h3>
                <button onclick="closeModal('qrModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <div id="qrContainer"></div>
                <div class="qr-actions">
                    <button onclick="downloadQR()" class="btn btn-success">Download PNG</button>
                    <button onclick="printQR()" class="btn">Print</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="firebase-config.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
